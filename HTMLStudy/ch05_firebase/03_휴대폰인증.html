<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>휴대폰 인증</title>

    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

    <script src="../resources/js/serviceKey-info.js"></script>
    <script>
        firebase.initializeApp(firebaseConfig)
    </script>
</head>

<body>
    <div>
        <input id="inputEmail" type="email" placeholder="이메일">
    </div>
    <div>
        <input id="inputPw" type="password" placeholder="비밀번호">
    </div>
    <div>
        <input id="inputName" type="text" placeholder="닉네임">
    </div>
    <div>
        <input id="inputPhone" type="text" placeholder="휴대폰 번호">
        <button id="sendMsgBtn">인증문자 전송</button>
    </div>
    <div>
        <input id="inputAuthNum" type="text" placeholder="인증번호">
        <button id="checkAuthNumBtn">인증문자 확인</button>
    </div>
    <button id="signUpBtn">회원가입</button>

    <script>
        firebase.auth().languageCode = "ko"

        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('sendMsgBtn', {
            'size': 'invisible',
            'callback': (response) => {
                // onSignInSubmit() 함수가 실행된 이후 문자를 보낼 수 있게됨
                onSignInSubmit();
            }
        })

        document.querySelector("#sendMsgBtn").addEventListener("click", () => {
            let v_inputPhone = document.querySelector("#inputPhone").value

            const phoneNumber = "+82" + v_inputPhone
            const appVerifier = window.recaptchaVerifier;
            firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                .then((confirmationResult) => {
                    window.confirmationResult = confirmationResult;
                }).catch((error) => {
                    console.log("SMS 전송 실패")
                })
        })

        document.querySelector("#checkAuthNumBtn").addEventListener("click", () => {
            let v_inputPhone = document.querySelector("#inputAuthNum").value

            confirmationResult.confirm(v_inputPhone).then((result) => {
                const user = result.user;
                console.log(user)
            }).catch((error) => {
                console.error(error)
            });
        })
    </script>
</body>

</html>